/*! Lets's Hangout - v0.1.0 - 2012-12-20
* http://webrtc.cheghamwassim.com/
* Copyright (c) 2012 Wassim Chegham; Licensed MIT */
(function(e,t){var n="ws://"+e.localtion.host+":1337/",r=document.getElementById("start"),i=document.getElementById("main-video"),s=+i.getAttribute("width"),o=+i.getAttribute("height"),u=document.getElementById("main-canvas"),a=document.getElementById("newRoom"),f=u.getContext("2d"),l=[],c=[1,2,3,4,5],h=e.PeerConnection||e.webkitPeerConnection00||e.webkitRTCPeerConnection||e.mozRTCPeerConnection||e.msRTCPeerConnection;e.requestAnimationFrame=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame;var p=function(e,t){var n=e,r=n.cloneNode(!1);return r.id="remote"+t,document.getElementById("videos").appendChild(r),l.push(r),r},d=function(e){var t=document.getElementById("remote"+e);t&&(l.splice(l.indexOf(t),1),t.parentNode.removeChild(t))},v=function(){var e=document.getElementById("fullscreen");e&&e.addEventListener("click",function(e){e.preventDefault(),document.querySelector("#main-canvas").webkitRequestFullScreen()})},m=function(){a&&a.addEventListener("click",function(t){g(),e.location.reload()})},g=function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n=8,r="";for(var i=0;i<n;i++){var s=Math.floor(Math.random()*t.length);r+=t.substring(s,s+1)}e.location.hash=r},y=function(){i.addEventListener("play",b,!1)},b=function(){if(i.paused||i.ended)return;w(),setTimeout(b,0)},w=function(){f.drawImage(i,0,0,s,o)},E=function(){h?rtc.createStream({video:!0,audio:!0},function(e){i.src=URL.createObjectURL(e),l.push(i),rtc.attachStream(e,"main-video"),y(),r.style.display="none"}):alert("PeerConnection was not found!");var t=e.location.hash.slice(1);rtc.connect(n,t),rtc.on("add remote stream",function(e,t){console.log("ADDING REMOTE STREAM...");var n=p(i,t);document.getElementById(n.id).setAttribute("class",""),rtc.attachStream(e,n.id)}),rtc.on("disconnect stream",function(e){console.log("remove "+e),d(e)}),v(),m(),g()};return function(){r.addEventListener("click",function(e){e.preventDefault(),E()},!1)}()})(this);